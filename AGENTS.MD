---
name: "Datadog APM Azure Vending Machine"
description: "React + TypeScript application for provisioning Azure App Services with Datadog APM instrumentation."
---

# Datadog APM Azure Vending Machine

## ğŸ“˜ Project Overview

This is a frontend web app built with **React 19**, **TypeScript**, and **Create React App**, designed to help users enable **Datadog APM** on **Azure App Services** through a GitHub-hosted UI. It integrates Microsoft Authentication (MSAL) for login, provides an interactive form-based UX, and automates deployment flows.

## âš™ï¸ Tech Stack

- **Framework**: React 19 (via Create React App)
- **Language**: TypeScript
- **Auth**: Azure AD via `@azure/msal-browser` and `@azure/msal-react`
- **Form Handling**: React Hook Form + Zod
- **Data Fetching**: TanStack React Query
- **Validation**: Zod schema validation
- **Linting & Formatting**: ESLint + Prettier
- **Testing**: Jest + React Testing Library + MSW
- **Deployment**: `gh-pages` (static hosting)

## ğŸ—‚ï¸ Project Structure

```
.
â”œâ”€â”€ public/                     # Static assets
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/             # UI components
â”‚   â”œâ”€â”€ pages/                  # Main route containers
â”‚   â”œâ”€â”€ hooks/                  # Custom React hooks
â”‚   â”œâ”€â”€ services/               # API and Azure service logic
â”‚   â”œâ”€â”€ forms/                  # React Hook Form schemas + UI
â”‚   â”œâ”€â”€ auth/                   # MSAL configuration & logic
â”‚   â”œâ”€â”€ types/                  # Global TS types
â”‚   â”œâ”€â”€ utils/                  # Helper functions
â”‚   â””â”€â”€ index.tsx              # Entry point
â”œâ”€â”€ tests/                      # Unit and integration tests
â”œâ”€â”€ .eslintrc.js                # ESLint rules
â”œâ”€â”€ .prettierrc                 # Prettier config
â”œâ”€â”€ tsconfig.json               # TypeScript config
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## ğŸš€ Development Workflow

### ğŸ§± Prerequisites

- **Node.js â‰¥ 18**
- **Yarn or npm**
- Azure credentials (via MSAL)
- Datadog API key (passed via form or env var)

### ğŸ› ï¸ Local Setup

```bash
git clone https://github.com/petems/azure-app-services-for-datadog-vending-machine
cd azure-app-services-for-datadog-vending-machine
yarn install
yarn start
```

This will launch the app on [http://localhost:3000](http://localhost:3000) using Vite dev server.

## ğŸ§ª Testing Strategy

### Run all tests:

```bash
yarn test
```

### Run with coverage:

```bash
yarn test:coverage
```

- Uses `jest-environment-jsdom`
- Mocks Azure + Datadog APIs via [MSW](https://mswjs.io/)
- Asserts on APM payloads, validation, UI flows

## ğŸ§¹ Linting & Formatting

```bash
yarn lint       # Fixable lint issues via ESLint
yarn format     # Format all code via Prettier
yarn type-check # Run tsc in --noEmit mode
```

## ğŸ— Build & Deploy

```bash
yarn build      # Runs TypeScript build + CRA production build
yarn deploy     # Publishes to GitHub Pages
```

Pages are auto-hosted at: `https://<username>.github.io/azure-app-services-for-datadog-vending-machine`

## ğŸ” Authentication

- Uses `@azure/msal-browser` and `@azure/msal-react`
- Users must sign in via Azure AD to proceed
- Tokens are cached and passed to internal API services

## âœï¸ Form + Validation Strategy

- UI forms built using **React Hook Form**
- Validation powered by **Zod schemas**
- API payloads structured to match ARM/Datadog requirements

```ts
import { z } from "zod";

export const APMConfigSchema = z.object({
  siteName: z.string().min(1),
  ddApiKey: z.string().length(32),
  ddSite: z.enum(["datadoghq.com", "datadoghq.eu", "us3.datadoghq.com"]),
  env: z.string(),
  service: z.string(),
});
```

## ğŸ§  React App Behavior

- **Initial state**: User must log in with Azure
- **Main flow**:
  1. Auth â†’ config form â†’ submit
  2. UI calls Azure APIs and Datadog APIs to configure site
  3. Success and errors shown via UI

- **Error handling**:
  - Uses `React Query` error boundaries
  - Form validation + API fallback errors
  - Logs sent to console and optionally to Datadog (via future tracing support)

## ğŸ›¡ï¸ Security Considerations

- Sensitive values like API keys are:
  - Never logged
  - Stored only in session/localStorage (if needed)
- Authentication handled by official Azure MSAL SDKs
- Uses HTTPS-only deployment

## ğŸ” CI Recommendations (if added)

- Run `yarn type-check`, `lint`, `test:coverage` on PRs
- Deploy preview using GitHub Pages Action
- Validate `.env` variables and Azure credentials via secrets

## ğŸ“š Reference Docs

- [React Docs](https://react.dev/)
- [MSAL React](https://github.com/AzureAD/microsoft-authentication-library-for-js/tree/dev/lib/msal-react)
- [Datadog APM](https://docs.datadoghq.com/tracing/)
- [React Hook Form](https://react-hook-form.com/)
- [Zod](https://zod.dev/)
- [TanStack Query](https://tanstack.com/query/v5)
